<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUVANI | AI-Powered Global News</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#e63946">

  <style>
    :root{--p:#e63946;--a:#00d4ff;--d:#0a0a0a;--l:#fff;--c:#f5f5f5;--b:#eee}
    body.dark-mode{--l:#1a1a1a;--c:#222;--b:#333}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,sans-serif;background:var(--c);color:#333;line-height:1.6}
    .container{max-width:1200px;margin:auto;padding:0 16px}
    header{background:var(--l);box-shadow:0 2px 8px rgba(0,0,0,.1);position:sticky;top:0;z-index:100}
    .header-main{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
    .logo{font-size:32px;font-weight:900;background:linear-gradient(45deg,var(--p),#c91828);-webkit-background-clip:text;color:transparent}
    .search-box input{border:none;outline:none;padding:8px 12px;width:180px;background:var(--c);border:1px solid var(--b);border-radius:25px}
    .mode-toggle{cursor:pointer;font-size:18px;padding:8px}
    .hero-news img{width:100%;height:380px;object-fit:cover;border-radius:12px}
    .news-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-top:20px}
    .news-card{background:var(--l);border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,.05)}
    .news-card img{width:100%;height:180px;object-fit:cover}
    .news-card-content{padding:16px}
    .loading{text-align:center;padding:50px;color:#888}
    .no-news{text-align:center;padding:50px;color:#e63946;font-weight:700}
  </style>
</head>
<body>
  <header>
    <div class="container header-main">
      <div><div class="logo">TRUVANI</div></div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="search-box"><input type="text" placeholder="Search..." id="search"></div>
        <i class="fa-solid fa-moon mode-toggle" id="modeToggle"></i>
        <a href="admin.html" style="background:var(--a);color:#000;padding:8px 16px;border-radius:25px;font-weight:600">ADMIN</a>
      </div>
    </div>
  </header>

  <div class="container">
    <div id="loading" class="loading">Loading news...</div>
    <div id="hero" class="hero-news" style="display:none"></div>
    <div id="grid" class="news-grid" style="display:none"></div>
    <div id="noNews" class="no-news" style="display:none">No articles yet. <a href="admin.html">Add from Admin</a></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
    import { getFirestore, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";

    const app = initializeApp({
      apiKey: "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A",
      authDomain: "truvani-news-5ac15.firebaseapp.com",
      projectId: "truvani-news-5ac15",
      storageBucket: "truvani-news-5ac15.firebasestorage.app",
      messagingSenderId: "742142167141",
      appId: "1:742142167141:web:c2c116f5e50a574de85e8c"
    });

    const db = getFirestore(app);
    const $ = s => document.querySelector(s);

    // Dark Mode
    $('#modeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      $('#modeToggle').classList.toggle('fa-moon');
      $('#modeToggle').classList.toggle('fa-sun');
      localStorage.setItem('dark', document.body.classList.contains('dark-mode'));
    });
    if (localStorage.getItem('dark') === 'true') {
      document.body.classList.add('dark-mode');
      $('#modeToggle').classList.replace('fa-moon', 'fa-sun');
    }

    // Load News
    const q = query(collection(db, 'articles'), orderBy('timestamp', 'desc'), limit(10));
    onSnapshot(q, snap => {
      $('#loading').style.display = 'none';
      if (snap.empty) {
        $('#noNews').style.display = 'block';
        return;
      }

      const articles = snap.docs.map(d => ({id: d.id, ...d.data()}));
      renderHero(articles[0]);
      renderGrid(articles.slice(1));
    }, err => {
      $('#loading').textContent = 'Error loading news. Check console.';
      console.error(err);
    });

    function renderHero(a) {
      $('#hero').innerHTML = `
        <a href="article.html?id=${a.id}" style="text-decoration:none;color:inherit">
          <img src="${a.imageUrl || 'https://via.placeholder.com/1200x400?text=TRUVANI+NEWS'}" alt="${a.title}">
          <div style="padding:20px"><h1 style="font-size:28px;margin:10px 0">${a.title}</h1></div>
        </a>
      `;
      $('#hero').style.display = 'block';
    }

    function renderGrid(articles) {
      const grid = $('#grid');
      grid.innerHTML = '';
      articles.forEach(a => {
        const card = document.createElement('div');
        card.className = 'news-card';
        card.innerHTML = `
          <a href="article.html?id=${a.id}" style="text-decoration:none;color:inherit">
            <img src="${a.imageUrl || 'https://via.placeholder.com/400x200?text=NEWS'}" alt="${a.title}">
            <div class="news-card-content">
              <h3>${a.title}</h3>
              <p style="color:#666;font-size:14px">${(a.content || '').substring(0,100)}...</p>
            </div>
          </a>
        `;
        grid.appendChild(card);
      });
      grid.style.display = 'grid';
    }

    // PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>
</body>
</html>
