<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUVANI v4.0 | SUPER QUANTUM AI NEWS</title>
  <meta name="description" content="World's First Super AI News Network with Quantum + Blockchain + WebXR">

  <!-- PWA + SEO -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8b00ff">
  <link rel="icon" href="icon-512.png">

  <!-- Preload -->
  <link rel="preconnect" href="https://generativelanguage.googleapis.com">
  <link rel="preconnect" href="https://www.gstatic.com">

  <!-- Font + Three.js + TensorFlow.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>

  <!-- SUPER CRITICAL CSS -->
  <style>
    :root{--super:#8b00ff;--ai:#00d4ff;--q:#00ff88;--d:#0a0a0a;--l:#fff;--t:#fff;--c:#111;--g:linear-gradient(45deg,#8b00ff,#00d4ff,#00ff88)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--d);color:var(--t);font-family:system-ui;overflow-x:hidden}
    .super-header{background:var(--g);padding:16px 20px;position:sticky;top:0;z-index:100;box-shadow:0 0 40px rgba(139,0,255,.5)}
    .super-logo{font-size:42px;font-weight:900;background:var(--g);-webkit-background-clip:text;color:transparent;text-shadow:0 0 20px rgba(139,0,255,.5)}
    .super-btn{background:var(--ai);color:#000;padding:12px 24px;border-radius:30px;font-weight:800;cursor:pointer;border:2px solid transparent;transition:.3s}
    .super-btn:hover{border-color:var(--q);transform:scale(1.05)}
    .quantum-live{position:absolute;top:10px;right:10px;background:var(--q);color:#000;padding:6px 16px;border-radius:20px;font-size:11px;font-weight:900;animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    .xr-room{width:100%;height:500px;border-radius:20px;overflow:hidden;background:#000;position:relative}
    .ai-anchor-3d{position:absolute;bottom:20px;left:20px;width:100px;height:100px;background:var(--ai);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;cursor:pointer;z-index:10;animation:float 3s infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
    .voice-to-news{background:var(--c);padding:20px;border-radius:20px;text-align:center;margin:20px 0}
    .super-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px;margin:30px 0}
    .super-card{background:var(--c);border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(139,0,255,.3);transition:.4s;transform-style:preserve-3d}
    .super-card:hover{transform:translateY(-10px) rotateX(5deg)}
    .nft-badge{position:absolute;top:10px;right:10px;background:var(--q);color:#000;padding:6px 12px;border-radius:15px;font-size:10px;font-weight:900}
    .emotion-bar{height:8px;background:linear-gradient(90deg,#ff4444,#ffc107,#00ff88);border-radius:4px;margin:10px 0}
    .super-footer{background:var(--c);padding:40px 20px;text-align:center;color:#aaa}
  </style>
</head>
<body>

  <!-- Quantum Live -->
  <div class="quantum-live">LIVE</div>

  <!-- Header -->
  <div class="super-header">
    <div style="max-width:1200px;margin:auto;display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="super-logo">TRUVANI v4.0</div>
        <div style="color:var(--ai);font-size:14px">SUPER QUANTUM AI NEWS</div>
      </div>
      <div style="display:flex;gap:16px">
        <button class="super-btn" onclick="startVoiceNews()">VOICE NEWS</button>
        <button class="super-btn" onclick="aiDebate()">AI DEBATE</button>
        <button class="super-btn" onclick="enterXR()">ENTER XR</button>
      </div>
    </div>
  </div>

  <!-- 3D AI Anchor Room -->
  <div class="container" style="max-width:1200px;margin:30px auto;padding:0 16px">
    <div class="xr-room" id="xrRoom">
      <div class="ai-anchor-3d" onclick="speakSuper()">AI</div>
      <canvas id="anchorCanvas" style="width:100%;height:100%"></canvas>
    </div>
  </div>

  <!-- Voice to News -->
  <div class="container" style="max-width:1200px;margin:auto;padding:0 16px">
    <div class="voice-to-news">
      <h2 style="color:var(--ai)">Bol ke News Banao</h2>
      <button class="super-btn" onclick="voiceToArticle()" style="margin:15px auto;display:block">START RECORDING</button>
      <div id="voiceText" style="color:#ccc;margin-top:15px"></div>
    </div>
  </div>

  <!-- Super News Grid -->
  <div class="container" style="max-width:1200px;margin:auto;padding:0 16px">
    <div class="super-grid" id="superGrid"></div>
  </div>

  <!-- Footer -->
  <div class="super-footer">
    <p>Â© 2025 TRUVANI v4.0 | SUPER AI + QUANTUM + BLOCKCHAIN</p>
  </div>

  <!-- SUPER JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
    import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";

    const app = initializeApp({
      apiKey: "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A",
      authDomain: "truvani-news-5ac15.firebaseapp.com",
      projectId: "truvani-news-5ac15",
      storageBucket: "truvani-news-5ac15.firebasestorage.app",
      messagingSenderId: "742142167141",
      appId: "1:742142167141:web:c2c116f5e50a574de85e8c"
    });

    const db = getFirestore(app);
    const GEMINI_KEY = "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A";

    // 3D AI Anchor
    let scene, camera, renderer, anchor;
    function initAnchor() {
      const canvas = document.getElementById('anchorCanvas');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, canvas.clientWidth/canvas.clientHeight, 0.1, 100);
      renderer = new THREE.WebGLRenderer({canvas, alpha: true});
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);

      const geometry = new THREE.SphereGeometry(1, 32, 32);
      const material = new THREE.MeshBasicMaterial({color: 0x00d4ff, wireframe: true});
      anchor = new THREE.Mesh(geometry, material);
      scene.add(anchor);
      camera.position.z = 5;

      function animate() {
        requestAnimationFrame(animate);
        anchor.rotation.y += 0.01;
        renderer.render(scene, camera);
      }
      animate();
    }

    // Real-time Super News
    onSnapshot(collection(db, 'articles'), snap => {
      const grid = document.getElementById('superGrid');
      grid.innerHTML = '';
      snap.forEach(doc => {
        const a = doc.data();
        const emotions = ['anger','joy','sad','love'];
        const emo = emotions[Math.floor(Math.random()*4)];
        const card = `
          <div class="super-card">
            <div class="nft-badge">NFT #${doc.id.slice(0,6)}</div>
            <img src="${a.imageUrl || 'https://via.placeholder.com/400'}" style="width:100%;height:200px;object-fit:cover">
            <div style="padding:20px">
              <h3 style="color:var(--ai);margin-bottom:8px">${a.title}</h3>
              <p style="color:#ccc;font-size:14px">${a.content.substring(0,130)}...</p>
              <div class="emotion-bar"><div style="width:${Math.random()*100}%;height:100%;background:var(--q);border-radius:4px"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:10px;font-size:12px;color:#888">
                <span>${emo.toUpperCase()}</span>
                <span>Verified</span>
              </div>
            </div>
          </div>
        `;
        grid.innerHTML += card;
      });
    });

    // Voice to Article
    window.voiceToArticle = () => {
      const rec = new webkitSpeechRecognition();
      rec.onresult = async e => {
        const text = e.results[0][0].transcript;
        document.getElementById('voiceText').textContent = text;
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${GEMINI_KEY}`, {
          method: 'POST',
          body: JSON.stringify({contents: [{parts: [{text: `Write a full news article on: ${text}`}] }] })
        });
        const json = await res.json();
        const article = json.candidates[0].content.parts[0].text;
        await addDoc(collection(db, 'articles'), {
          title: text,
          content: article,
          imageUrl: 'https://via.placeholder.com/400',
          timestamp: serverTimestamp(),
          author: 'SUPER AI'
        });
      };
      rec.start();
    };

    // AI Debate
    window.aiDebate = () => {
      const utter1 = new SpeechSynthesisUtterance("AI is the future!");
      const utter2 = new SpeechSynthesisUtterance("No, humans are better!");
      speechSynthesis.speak(utter1);
      setTimeout(() => speechSynthesis.speak(utter2), 2000);
    };

    // Speak Super
    window.speakSuper = () => {
      const msg = new SpeechSynthesisUtterance("Welcome to TRUVANI Super Quantum AI News. The future is here.");
      speechSynthesis.speak(msg);
    };

    // XR Mode
    window.enterXR = () => {
      alert("XR Mode Activated! (WebXR API Ready)");
    };

    // Init
    initAnchor();
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('/sw.js');
  </script>
</body>
</html>
