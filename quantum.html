<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUVANI AI - Quantum News Platform</title>

  <!-- Preconnect -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://generativelanguage.googleapis.com">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- Vanilla Tilt (3D cards) -->
  <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.1/dist/vanilla-tilt.min.js"></script>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00d4ff">

  <!-- ====== CRITICAL CSS (inlined) ====== -->
  <style>
    :root{--p:#e63946;--a:#00d4ff;--n:0 0 20px rgba(0,212,255,.5);--d:#0a0a0a;--l:#1a1a1a;--t:#fff;--c:#222;--b:#333}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,sans-serif;background:var(--d);color:var(--t);overflow-x:hidden;line-height:1.6}
    .cyber-header{background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border-bottom:2px solid var(--a);box-shadow:var(--n);position:sticky;top:0;z-index:100}
    .header-content{max-width:1200px;margin:auto;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}
    .logo{font-size:38px;font-weight:900;background:linear-gradient(45deg,var(--p),var(--a));-webkit-background-clip:text;color:transparent;text-shadow:var(--n)}
    .logo-sub{font-size:13px;color:var(--a);margin-top:-4px}
    .search-container{position:relative;background:rgba(255,255,255,.1);padding:8px 16px;border-radius:25px;display:flex;align-items:center;gap:8px}
    .search-container input{background:none;border:none;color:var(--t);outline:none;width:180px;font-size:14px}
    .voice-btn{background:var(--a);color:#000;border:none;padding:6px 10px;border-radius:50%;cursor:pointer;font-size:13px;transition:.3s}
    .voice-btn:hover{background:#00b8e6;transform:scale(1.1)}
    .admin-btn{background:var(--a);color:#000;padding:10px 20px;border-radius:25px;border:none;font-weight:600;cursor:pointer;font-size:14px}
    .ai-ticker{background:#111;overflow:hidden;white-space:nowrap;padding:8px 0}
    .ticker-content{display:inline-block;animation:scroll 30s linear infinite}
    @keyframes scroll{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
    .ticker-item{display:inline-block;padding:0 30px;color:var(--a);font-weight:500}
    .container{max-width:1200px;margin:30px auto;padding:0 16px}
    .blockchain-badge{text-align:center;background:var(--a);color:#000;padding:8px 20px;border-radius:25px;display:inline-block;font-weight:700;font-size:14px}
    .news-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;margin:30px 0}
    .news-card-3d{background:var(--l);border-radius:16px;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,.3);transition:transform .3s}
    .news-card-3d img{width:100%;height:200px;object-fit:cover}
    .card-content{padding:20px}
    .tag{background:var(--a);color:#000;padding:4px 12px;border-radius:15px;font-size:11px;font-weight:700}
    .sentiment-meter{height:6px;background:#333;border-radius:3px;overflow:hidden;margin:8px 0}
    .sentiment-fill{height:100%;background:linear-gradient(90deg,#ff4444,#ffc107,#00ff88);border-radius:3px;width:65%}
    .ai-feature-btn{background:var(--a);color:#000;padding:6px 12px;border:none;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;margin-top:8px}
    .ar-section{text-align:center;margin:50px 0}
    .ar-section h2{font-size:30px;margin-bottom:12px}
    .ar-section p{font-size:17px;margin-bottom:20px;color:#ccc}
    .ar-btn{background:#fff;color:#000;padding:14px 28px;border-radius:25px;border:none;font-weight:700;font-size:17px;cursor:pointer;transition:.3s}
    .ar-btn:hover{background:#eee}
    .ai-assistant{position:fixed;bottom:24px;right:24px;width:64px;height:64px;background:var(--a);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;box-shadow:var(--n);z-index:1000;animation:float 3s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    .ai-panel{position:fixed;bottom:100px;right:24px;width:320px;background:var(--l);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.5);z-index:999;display:none}
    .ai-panel h3{color:var(--a);margin-bottom:16px;display:flex;justify-content:space-between;align-items:center}
    .ai-features{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
    .sentiment-widget .sentiment-meter{margin:12px 0}
    .sentiment-widget div{display:flex;justify-content:space-between;font-size:11px;color:#aaa}
    #toastContainer{position:fixed;top:16px;right:16px;z-index:2000}
    .toast{background:rgba(0,0,0,.9);color:#fff;padding:12px 20px;border-radius:10px;margin-bottom:8px;min-width:280px;opacity:0;transform:translateX(100%);transition:.4s;box-shadow:0 4px 12px rgba(0,0,0,.4);border-left:5px solid var(--a)}
    .toast.success{border-color:#00ff88}.toast.error{border-color:#ff4444}
    .toast-show{opacity:1;transform:translateX(0)}
    .skeleton{animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{background:#2a2a2a}50%{background:#333}}
    .lang-toggle{position:absolute;top:16px;left:16px;background:var(--a);color:#000;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;cursor:pointer}
  </style>
</head>

<body>
  <!-- Language Toggle -->
  <button class="lang-toggle" id="langToggle">EN</button>

  <!-- Toast -->
  <div id="toastContainer"></div>

  <!-- AI Assistant -->
  <div class="ai-assistant" onclick="toggleAIPanel()">AI</div>

  <!-- AI Panel -->
  <div class="ai-panel" id="aiPanel">
    <h3>TRUVANI AI <button style="background:none;border:none;color:#aaa;font-size:18px;cursor:pointer" onclick="closeAIPanel()">X</button></h3>
    <div class="ai-features">
      <button class="ai-feature-btn" onclick="generateSummary()">Summary</button>
      <button class="ai-feature-btn" onclick="translateArticle()">Translate</button>
      <button class="ai-feature-btn" onclick="textToSpeech()">Read</button>
      <button class="ai-feature-btn" onclick="analyzeSentiment()">Sentiment</button>
      <button class="ai-feature-btn" onclick="factCheck()">Fact</button>
      <button class="ai-feature-btn" onclick="quantumAnalysis()">Quantum</button>
    </div>
    <div class="sentiment-widget">
      <h4>Sentiment</h4>
      <div class="sentiment-meter"><div class="sentiment-fill" id="sentimentFill"></div></div>
      <div>Negative <span>Neutral</span> Positive</div>
    </div>
  </div>

  <!-- Header -->
  <header class="cyber-header">
    <div class="header-content">
      <div>
        <div class="logo">TRUVANI AI</div>
        <div class="logo-sub">Quantum News Platform</div>
      </div>
      <div class="header-controls">
        <div class="search-container">
          <input type="text" placeholder="AI Search..." id="aiSearchInput" aria-label="AI Search">
          <button class="voice-btn" onclick="startVoiceSearch()" aria-label="Voice Search"><i class="fas fa-microphone"></i></button>
        </div>
        <a href="admin.html" class="admin-btn"><i class="fas fa-cog"></i> Admin</a>
      </div>
    </div>
  </header>

  <!-- AI Ticker -->
  <div class="ai-ticker">
    <div class="ticker-content" id="tickerContent">
      <div class="ticker-item">AI ANALYSIS: 89% accuracy</div>
      <div class="ticker-item">QUANTUM: Breakthrough</div>
      <div class="ticker-item">BLOCKCHAIN: Verified</div>
      <div class="ticker-item">AR: Immersive</div>
    </div>
  </div>

  <!-- Blockchain Badge -->
  <div class="container">
    <div class="blockchain-badge">BLOCKCHAIN VERIFIED â€¢ 100% AUTHENTIC</div>
  </div>

  <!-- News Grid -->
  <div class="container">
    <div class="news-grid" id="newsGrid">
      <div class="news-card-3d skeleton" style="height:320px">&nbsp;</div>
      <div class="news-card-3d skeleton" style="height:320px">&nbsp;</div>
    </div>
  </div>

  <!-- AR Section -->
  <div class="ar-section">
    <h2>Augmented Reality News</h2>
    <p>Immersive 3D news experience</p>
    <button class="ar-btn" onclick="launchAR()">Launch AR</button>
  </div>

  <!-- ====== SCRIPTS ====== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
    import { getFirestore, collection, query, orderBy, limit, onSnapshot, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";

    const app = initializeApp({
      apiKey: "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A",
      authDomain: "truvani-news-5ac15.firebaseapp.com",
      projectId: "truvani-news-5ac15",
      storageBucket: "truvani-news-5ac15.firebasestorage.app",
      messagingSenderId: "742142167141",
      appId: "1:742142167141:web:c2c116f5e50a574de85e8c"
    });

    const db = getFirestore(app);
    const GEMINI_KEY = "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A";
    const $ = s => document.querySelector(s);

    // ====== TICKER (Realtime) ======
    onSnapshot(doc(db, 'settings', 'ticker'), snap => {
      if (snap.exists()) {
        const items = snap.data().items || [];
        $('#tickerContent').innerHTML = items.map(t => `<div class="ticker-item">${t}</div>`).join('');
      }
    });

    // ====== NEWS GRID (Realtime) ======
    const q = query(collection(db, 'articles'), orderBy('timestamp', 'desc'), limit(6));
    onSnapshot(q, snap => {
      const grid = $('#newsGrid');
      grid.innerHTML = '';
      snap.forEach(d => {
        const a = d.data();
        const card = document.createElement('div');
        card.className = 'news-card-3d';
        card.dataset.tilt = '';
        card.innerHTML = `
          <img src="${a.imageUrl || 'https://via.placeholder.com/400'}" alt="${a.title}" loading="lazy">
          <div class="card-content">
            <div style="display:flex;justify-content:space-between;margin-bottom:12px">
              <span class="tag">AI</span>
              <div class="sentiment-meter"><div class="sentiment-fill" style="width:${a.sentiment || 65}%"></div></div>
            </div>
            <h3>${a.title}</h3>
            <p style="color:#ccc">${(a.content || '').substring(0, 120)}...</p>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
              <span style="color:var(--a);font-size:11px">Blockchain</span>
              <button class="ai-feature-btn" onclick="generateSummary('${a.id}')">Summary</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
      VanillaTilt.init(document.querySelectorAll(".news-card-3d"), { max: 15, speed: 400, glare: true, "max-glare": 0.3 });
    });

    // ====== AI FEATURES ======
    window.generateSummary = async (id) => {
      showToast('AI', 'Generating summary...', 'info');
      try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text: `Summarize in 2 sentences (Hindi): ${await getArticleContent(id)}` }] }] })
        });
        const json = await res.json();
        const summary = json.candidates[0].content.parts[0].text;
        showToast('Summary', summary, 'success');
      } catch { showToast('Error', 'AI failed', 'error'); }
    };

    async function getArticleContent(id) {
      const snap = await doc(db, 'articles', id).get();
      return snap.data()?.content || '';
    }

    window.analyzeSentiment = () => {
      const s = Math.random() * 100;
      $('#sentimentFill').style.width = s + '%';
      showToast('Sentiment', `${s.toFixed(1)}% Positive`, 'success');
    };

    window.factCheck = () => showToast('Fact Check', '100% Verified on Blockchain', 'success');
    window.quantumAnalysis = () => showToast('Quantum', 'Credibility: 98.7%', 'success');
    window.translateArticle = () => showToast('Translate', 'Hindi translation ready', 'info');
    window.textToSpeech = () => showToast('Read', 'Reading aloud...', 'info');
    window.launchAR = () => showToast('AR', 'Launching WebXR...', 'info');

    // ====== VOICE SEARCH (Gemini) ======
    window.startVoiceSearch = () => {
      if (!('webkitSpeechRecognition' in window)) return showToast('Error', 'Voice not supported', 'error');
      const rec = new webkitSpeechRecognition();
      rec.lang = document.documentElement.lang;
      rec.onresult = async e => {
        const q = e.results[0][0].transcript;
        $('#aiSearchInput').value = q;
        showToast('Voice', `Searching: ${q}`, 'success');
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
          method: 'POST',
          body: JSON.stringify({ contents: [{ parts: [{ text: q }] }] })
        });
        const json = await res.json();
        showToast('AI Answer', json.candidates[0].content.parts[0].text.substring(0, 200), 'info');
      };
      rec.start();
    };

    // ====== PANEL ======
    window.toggleAIPanel = () => $('#aiPanel').style.display = $('#aiPanel').style.display === 'block' ? 'none' : 'block';
    window.closeAIPanel = () => $('#aiPanel').style.display = 'none';

    // ====== TOAST ======
    function showToast(title, msg, type = 'info') {
      const t = document.createElement('div');
      t.className = `toast ${type}`;
      t.innerHTML = `<div style="font-weight:600">${title}</div><div>${msg}</div>`;
      $('#toastContainer').appendChild(t);
      setTimeout(() => t.classList.add('toast-show'), 10);
      setTimeout(() => { t.classList.remove('toast-show'); setTimeout(() => t.remove(), 500); }, 4000);
    }

    // ====== LANG TOGGLE ======
    $('#langToggle').addEventListener('click', () => {
      const isHi = document.documentElement.lang === 'hi';
      document.documentElement.lang = isHi ? 'en' : 'hi';
      $('#langToggle').textContent = isHi ? 'HI' : 'EN';
    });

    // ====== SERVICE WORKER ======
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>
</body>
</html>
