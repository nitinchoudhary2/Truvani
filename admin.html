<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUVANI ADMIN v2.1</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    :root{--p:#8b00ff;--a:#00d4ff;--g:#00ff88;--r:#ff4444;--d:#0a0a0a;--l:#fff;--c:#111;--b:#222}
    body{background:var(--d);color:var(--l);font-family:system-ui;margin:0;overflow-x:hidden}
    .header{background:var(--c);padding:16px;position:sticky;top:0;z-index:100;box-shadow:0 0 30px rgba(139,0,255,.4)}
    .logo{font-size:36px;font-weight:900;background:linear-gradient(45deg,var(--p),var(--a));-webkit-background-clip:text;color:transparent}
    .grid{display:grid;grid-template-columns:250px 1fr;gap:24px;padding:20px;max-width:1400px;margin:auto}
    .sidebar{background:var(--c);border-radius:16px;padding:20px}
    .btn{background:var(--p);color:#fff;padding:14px;border-radius:12px;margin:10px 0;cursor:pointer;font-weight:700}
    .main{background:var(--c);border-radius:16px;padding:24px}
    .tab{display:none}
    .tab.active{display:block}
    input,textarea,select{width:100%;padding:12px;margin:8px 0;border:1px solid #444;border-radius:8px;background:#222;color:#fff}
    .publish{background:var(--g);color:#000;padding:16px 32px;border:none;border-radius:12px;font-weight:900;cursor:pointer}
    .preview{background:var(--b);padding:20px;border-radius:12px;margin:16px 0;color:#ccc}
    .list-item{background:var(--b);padding:16px;border-radius:12px;margin:12px 0;display:flex;justify-content:space-between}
    .del{background:var(--r);color:#fff;padding:8px 16px;border:none;border-radius:8px;cursor:pointer}
    .logout{position:absolute;top:20px;right:20px;background:var(--r);padding:10px 20px;border-radius:20px;cursor:pointer}
  </style>
</head>
<body>

  <div class="logout" onclick="logout()">LOGOUT</div>

  <div class="header">
    <div style="max-width:1400px;margin:auto;display:flex;align-items:center">
      <div class="logo">TRUVANI ADMIN v2.1</div>
    </div>
  </div>

  <div class="grid">
    <div class="sidebar">
      <div class="btn" onclick="openTab('dash')">Dashboard</div>
      <div class="btn" onclick="openTab('pub')">Publish</div>
      <div class="btn" onclick="openTab('man')">Manage</div>
      <div class="btn" onclick="openTab('ai')">AI Tools</div>
    </div>

    <div class="main">
      <!-- Dashboard -->
      <div id="dash" class="tab active">
        <h2 style="color:var(--a)">Dashboard</h2>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px">
          <div style="background:var(--p);padding:20px;border-radius:16px;text-align:center;color:#fff">
            <h1 id="total">0</h1><p>Articles</p>
          </div>
          <div style="background:var(--p);padding:20px;border-radius:16px;text-align:center;color:#fff">
            <h1 id="aiCount">0</h1><p>AI Generated</p>
          </div>
          <div style="background:var(--p);padding:20px;border-radius:16px;text-align:center;color:#fff">
            <h1>98.7%</h1><p>Verified</p>
          </div>
          <div style="background:var(--p);padding:20px;border-radius:16px;text-align:center;color:#fff">
            <h1>ONLINE</h1><p>System</p>
          </div>
        </div>
      </div>

      <!-- Publish -->
      <div id="pub" class="tab">
        <h2 style="color:var(--a)">Publish Article</h2>
        <input type="text" id="title" placeholder="Title">
        <textarea id="content" rows="6" placeholder="Content..."></textarea>
        <input type="file" id="img" accept="image/*">
        <button class="publish" onclick="publishNow()">PUBLISH</button>
        <div class="preview" id="prev"></div>
      </div>

      <!-- Manage -->
      <div id="man" class="tab">
        <h2 style="color:var(--a)">Manage Articles</h2>
        <div id="list"></div>
      </div>

      <!-- AI -->
      <div id="ai" class="tab">
        <h2 style="color:var(--a)">AI Tools</h2>
        <input type="text" id="topic" placeholder="Topic for AI article">
        <button class="publish" onclick="genAI()">Generate AI Article</button>
        <button class="publish" style="margin-top:10px" onclick="auto10()">Auto 10 Articles</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A",
      authDomain: "truvani-news-5ac15.firebaseapp.com",
      projectId: "truvani-news-5ac15",
      storageBucket: "truvani-news-5ac15.firebasestorage.app",
      messagingSenderId: "742142167141",
      appId: "1:742142167141:web:c2c116f5e50a574de85e8c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const GEMINI_KEY = "AIzaSyAeGWwKLkHB43i1FbedgkANPKcTCBh0Z9A";

    // Login
    if (!localStorage.getItem('admin')) {
      const p = prompt("Admin Password:");
      if (p !== "truvani123") { alert("Wrong!"); window.location.href = "/"; }
      localStorage.setItem('admin', 'true');
    }

    // Tabs
    window.openTab = (id) => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    };

    // Publish
    window.publishNow = async () => {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const file = document.getElementById('img').files[0];
      
      if (!title || !content) return alert("Fill title & content");

      let imageUrl = 'https://via.placeholder.com/400';
      if (file) {
        const storageRef = ref(storage, 'images/' + Date.now() + '.jpg');
        await uploadBytes(storageRef, file);
        imageUrl = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, 'articles'), {
        title, content, imageUrl, timestamp: serverTimestamp(), author: 'Admin'
      });

      alert("Published!");
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('img').value = '';
    };

    // Live Articles
    onSnapshot(collection(db, 'articles'), (snap) => {
      document.getElementById('total').textContent = snap.size;
      const aiCount = snap.docs.filter(d => d.data().author?.includes('AI')).length;
      document.getElementById('aiCount').textContent = aiCount;

      const list = document.getElementById('list');
      list.innerHTML = '';
      snap.forEach(d => {
        const a = d.data();
        list.innerHTML += `
          <div class="list-item">
            <div><strong>${a.title}</strong><br><small>${a.author || 'Unknown'}</small></div>
            <button class="del" onclick="remove('${d.id}')">DELETE</button>
          </div>
        `;
      });
    });

    window.remove = (id) => {
      if (confirm("Delete?")) deleteDoc(doc(db, 'articles', id));
    };

    // AI Generate
    window.genAI = async () => {
      const topic = document.getElementById('topic').value || "Breaking News";
      const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ contents: [{ parts: [{ text: `Write a short news article: ${topic}` }] }] })
      });
      const data = await res.json();
      const text = data.candidates[0].content.parts[0].text;
      document.getElementById('title').value = topic;
      document.getElementById('content').value = text;
      openTab('pub');
    };

    // Auto 10
    window.auto10 = async () => {
      const topics = ["AI", "Quantum", "Blockchain", "Space", "Climate", "5G", "Metaverse", "Web3", "NFT", "Crypto"];
      for (let t of topics) {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
          method: 'POST',
          body: JSON.stringify({ contents: [{ parts: [{ text: `Short news on ${t}` }] }] })
        });
        const data = await res.json();
        await addDoc(collection(db, 'articles'), {
          title: t + " Update",
          content: data.candidates[0].content.parts[0].text,
          imageUrl: 'https://via.placeholder.com/400',
          timestamp: serverTimestamp(),
          author: 'AI Auto'
        });
      }
      alert("10 Articles Published!");
    };

    window.logout = () => {
      localStorage.removeItem('admin');
      window.location.href = "/";
    };
  </script>
</body>
</html>
